#flask(不知道做啥的)
from flask import Flask, request, abort

#開啟各種API認證
#from config import *

#基礎模組
import time

#JSON編碼解碼
import json

#lineAPI
from linebot import (LineBotApi, WebhookHandler)
from linebot.exceptions import (InvalidSignatureError)
from linebot.models import *
from MessageForm import *

#AI自然語言分析(DialogFlow)
import apiai

app = Flask(__name__)

#LINEAPI認證
ai = apiai.ApiAI('084bce6e157c47d39d5cb23715b47b69')
line_bot_api = LineBotApi('TNwu7tqho7m8MnMSmG8jpAF8tWl+hzBQzb/JKdbDBJv3HkMAUJiz8uo0nS0hG89tbsjQk8IV02p/v5ChZ1txRKjMlvPufgBPak5Y5AEwJt84wc9Mocg+yeZ8oyRQcfwFKnfmNaNRJR27Qc9r6iY38AdB04t89/1O/w1cDnyilFU=')
handler = WebhookHandler('d184dfc3ec38e22fb7edf6b7275023a8')



# 監聽所有來自 /callback 的 Post Request
@app.route("/callback", methods=['POST'])
def callback():
    # get X-Line-Signature header value
    signature = request.headers['X-Line-Signature']
    # get request body as text
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)
    # handle webhook body
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'

# ================= API語言客製區 Start =================
def is_alphabet(uchar):
    if ('\u0041' <= uchar<='\u005a') or ('\u0061' <= uchar<='\u007a'):
        print('English')
        return "en"
    elif '\u4e00' <= uchar<='\u9fff':
        #print('Chinese')
        print('Chinese')
        return "zh-tw"
    else:
        return "en"
# ================= API語言客製區 End =================


# ================= 獲得使用者訊息 =================
@handler.add(MessageEvent, message=TextMessage)
def handle_text_message(event):
    print(event.message.text)
    msg = event.message.text # message from user
    uid = event.source.user_id # user id
    
    # 1. 傳送使用者輸入到 dialogflow 上
    ai_request = ai.text_request()
    #ai_request.lang = "en"
    ai_request.lang = is_alphabet(msg)
    ai_request.session_id = uid
    ai_request.query = msg
    try:
        profile = line_bot_api.get_profile(uid)
        print(profile.display_name)
        print(profile.status_message)
        print(uid)
        print(profile.picture_url)
    except LineBotApiError as e:
        #error handle 
        print(e)

    # 2. 獲得使用者的意圖
    ai_response = json.loads(ai_request.getresponse().read())
    user_intent = ai_response['result']['metadata']['intentName']

    # 3. 根據使用者的意圖做相對應的回答
    if event.message.text == "圖片範例": #輸入你預期使用者會輸入的部分
        best_img = image_message('data:image/jpeg;base64,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','http://i.epochtimes.com/assets/uploads/2017/09/Helen-Sloan-HBO-Photo-5-600x400.jpg')
        line_bot_api.reply_message(event.reply_token,best_img)

    #以下code用來蒐集使用者錯誤的訊息來加強訓練
    elif event.message.text == "讀取錯誤": # 讀取error_text的內容
        f = open('error_text.txt','r', encoding='UTF-8')
        look = f.read()
        line_bot_api.reply_message(event.reply_token,TextSendMessage(text=look))

    elif event.message.text == "刪除錯誤": # 刪除error_text的內容
        f = open('error_text.txt','w')

    else: # 聽不懂時在error_text做紀錄
        f = open('error_text.txt','a')
        f.write(event.message.text+'\n')
'''
# 處理訊息
@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    message = TextSendMessage(text=event.message.text)
    line_bot_api.reply_message(event.reply_token, message)
'''
import os
if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)
